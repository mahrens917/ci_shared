# =============================================================================
# Shared Tool Configuration for CI Pipeline
# =============================================================================
#
# This file contains standardized tool configurations used across ALL repositories
# (zeus, kalshi, aws, ci_shared) to ensure consistent CI behavior.
#
# WHY THIS EXISTS:
#   - Each repo has its own pyproject.toml with repo-specific metadata/dependencies
#   - However, tool configurations (ruff, bandit, pytest, etc.) should be identical
#   - This file is the single source of truth for [tool.*] sections
#
# CONSUMING REPOSITORIES (zeus, kalshi, aws):
#
# 1. Initial Setup - Copy tool configs to your pyproject.toml:
#      cd /path/to/your/repo
#      python -m ci_tools.scripts.tool_config_guard --sync
#
# 2. Validation - Check if your configs match:
#      python -m ci_tools.scripts.tool_config_guard
#
# 3. Keep in Sync - When this file is updated, re-run sync:
#      python -m ci_tools.scripts.tool_config_guard --sync
#
# NOTES:
#   - Only [tool.*] sections are standardized
#   - Project metadata ([project], [build-system]) remains repo-specific
#   - Dependencies remain repo-specific
#   - The guard validates but doesn't auto-modify (prevents corruption)
#
# =============================================================================
#
# NOTE: [tool.deptry] is intentionally EXCLUDED because each repository has
# different dependencies, package structures, and ignore rules. Deptry configs
# should remain repository-specific.
# =============================================================================

[tool.pytest.ini_options]
pythonpath = ["."]
addopts = [
    "--tb=short",  # Shorter tracebacks
    "-q",          # Quiet mode (less output)
]

[tool.coverage.run]
# Exclude test code from coverage - we only measure production code
omit = [
    "*/vendor/*",
    "*/__main__.py",
    "tests/*",           # Exclude test directory
    "*/tests/*",         # Exclude tests in any subdirectory
    "*_test_*.py",       # Exclude test utility files (e.g., api_test_utils.py)
    "*/dependency_injector/*.pyx",    # Exclude Cython files that can't be parsed
    "*/dependency_injector/**/*.pyx", # Exclude all nested Cython files
    "*/site-packages/*", # Exclude all third-party packages
]

[tool.bandit]
# Skip checks that are expected/acceptable in our codebase
skips = [
    "B101",  # assert_used - used appropriately in tests
    "B301",  # pickle - trusted-only serialization helpers
    "B403",  # import_pickle - trusted-only serialization helpers
    "B105",  # hardcoded_password_string - test fixtures deliberately use literals
    "B106",  # hardcoded_password_funcarg - test fixtures deliberately use literals
    "B107",  # hardcoded_password_default - NOAA sentinel tokens flagged as passwords
    "B108",  # hardcoded_tmp_directory - acceptable in test fixtures
    "B110",  # try_except_pass - intentional cleanup guards suppress noisy logs
    "B311",  # random - standard RNG acceptable for jitter/data sampling
    "B404",  # import_subprocess - required for CI automation
    "B603",  # subprocess_without_shell_equals_true - our subprocess calls are safe
    "B607",  # start_process_with_partial_path - standard system commands (git, etc.)
    "B608",  # hardcoded_sql_expressions - false positive with internal field names
]
exclude_dirs = ["/vendor/", "/.venv/", "/venv/", "/artifacts/", "/trash/", "/models/", "/logs/"]

[tool.ruff]
extend-exclude = ["ci_tools/vendor"]

[tool.ruff.lint]
select = ["TRY", "C90", "PLR"]  # C90=McCabe complexity, PLR=Pylint refactor
ignore = ["TRY003"]  # Allow long exception messages

[tool.ruff.lint.mccabe]
max-complexity = 10

[tool.ruff.lint.pylint]
max-args = 7
max-branches = 10
max-statements = 50

[tool.ruff.lint.per-file-ignores]
"tests/**" = ["TRY002", "TRY203", "PLR2004"]
